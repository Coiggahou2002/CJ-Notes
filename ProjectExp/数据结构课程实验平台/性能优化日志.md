# æ€§èƒ½ä¼˜åŒ–æ—¥å¿—

## æ—¥å¿—

### 2021-12-15

éƒ¨ç½²é˜¿é‡Œäº‘ Nginxï¼Œé¦–å±åŠ è½½é•¿è¾¾ 60 å¤šç§’

å°è¯• `webpack-bundle-analyzer`ï¼Œæ²¡è£…å¥½ï¼Œä»¥åå†è¯•

1. å°è¯•è·¯ç”±å…¨éƒ¨æ”¹æˆæ‡’åŠ è½½ï¼Œç¼©çŸ­è‡³ 55 ç§’ï¼Œæ²¡æœ‰æ˜æ˜¾æ”¹å–„
2. vue, vuex, vue-router éƒ½æ”¹æˆ cdnï¼Œä»ç„¶ 60 ç§’

#### Vuetify ä¼˜åŒ–

å‘ç°æœ‰ä¸ª `check_vendorxxxx.css` å¾ˆå¤§å¾ˆå¤§ï¼Œå ç”¨äº† 60 ç§’ï¼Œæ‰“å¼€çœ‹äº†ä¸€ä¸‹åº”è¯¥æ˜¯ Vuetify çš„ CSSï¼Œè€ƒè™‘ä½¿ç”¨ CDN å¼•å…¥ Vuetify

CDN å¼•å…¥ Vuetifyï¼Œ50s?

è¿™ä¸ª chunk-vendors.css ä¾ç„¶å¾ˆå¤§ï¼Œè€—æ—¶ 49.5s

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211215232542.png)

package.json å»æ‰è·Ÿ Vuetify æœ‰å…³çš„ä¸œè¥¿ä¹‹åï¼Œ35s å‡ºç•Œé¢

`main.js` ä¸­ `import vuetify from './plugins/vuetify'` æ”¹ä¸º `import vuetify from 'vuetify'` 

package.json ä¸­åˆ æ‰çš„æœ‰å…³ Vuetify çš„ä¸œè¥¿

```json
"dependencies": {
    "vuetify": "^2.4.0"
  },
"devDependencies": {
    "@mdi/font": "^6.1.95",
    "vue-cli-plugin-vuetify": "~2.4.2",
    "vuetify-loader": "^1.7.0"
}
```

ç„¶å webpack çš„ externals

```javascript
externals: {
  'vue': 'Vue',
  'vue-router': 'VueRouter',
  'vuex': 'Vuex',
  'vuetify': 'vuetify'
}
```

#### Antd ä¼˜åŒ–

å¼•å…¥ CDN

```html
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.js"></script>
```

å» package.json

```json
"dependencies": {
    "ant-design-vue": "^1.7.8" // åˆ é™¤è¿™é¡¹
},
```

é… externals

```js
externals: {
  'ant-design-vue': 'antd'
}
```

### 2021-12-16

æ‰“åŒ…åå‘ç°æœ‰ä¸ª js å±…ç„¶æœ‰ 2 MB å·¦å³ï¼Œåˆæ­¥æ’æŸ¥å¯èƒ½æ˜¯ MonacoEditor

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211216113331.png)

#### Axios ä¸Š CDN

æå®šäº†

#### 

èƒ½è®¿é—® jsdelivr çš„æƒ…å†µä¸‹ï¼Œ5 ç§’å‡ºç™»é™†é¡µé¢

é‡ç‚¹åˆ†æç›®æ ‡ï¼š

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211216114636.png)

å…ˆçœ‹çœ‹ç¬¬ä¸€ä¸ªæ˜¯æ€ä¹ˆå›äº‹ï¼Œç›´æ¥è¿›æ–‡ä»¶ï¼Œçœ‹åˆ°å¾ˆå¤š `mermaid`ï¼Œåº”è¯¥æ˜¯ mermaid ç›¸å…³çš„ä¸œè¥¿

```json
"@bytemd/plugin-mermaid": "^1.10.13",
```

ç§»é™¤ MarkdownContent å’Œ MarkdownEditor ç»„ä»¶ä¸­çš„ mermaid å¼•å…¥ï¼Œä»¥åŠ package.json ä¸­çš„ mermaid ä¾èµ–ï¼Œçœ‹ä¸€ä¸‹èƒ½å‡å°‘å¤šå°‘ä½“ç§¯

ç°åœ¨æ­£å¸¸ 5 ç§’éƒ½èƒ½è¿›é¡µé¢äº†ï¼Œmermaid æš‚æ—¶ä¸è€ƒè™‘ä¿ç•™äº†ï¼Œæ¯•ç«Ÿä¹Ÿä¸æ˜¯ä»€ä¹ˆå¸¸ç”¨çš„åŠŸèƒ½ï¼Œä»¥åéœ€è¦å†åŠ 

ç›®å‰è€ƒè™‘æŠŠä¸€äº›é€šç”¨çš„åº“å…¨éƒ¨ä¸Š CDNï¼Œå…¶ä»–ä¼˜åŒ–å°±æš‚æ—¶ä¸åšäº†

- [x] axios
- [x] CryptoJS

è¿™ä¸ªä¹Ÿåˆ æ‰äº†ï¼Œçœ‹çœ‹å®ƒæ˜¯ä¸æ˜¯å¤§å—å¤´

```
"mavon-editor": "^2.9.1",
```

## ä¼˜åŒ–æ€è·¯

### å›ºå®šåº“å’Œæ¨¡å—å…¨éƒ¨æ”¹æˆ CDN å¼•å…¥

éœ€è¦ CDN å¼•å…¥çš„æ¨¡å—ï¼š

+ Vuex
+ Vue
+ VueRouter
+ axios

æ–¹æ³•ï¼š

1. `public/index.html` çš„ head ä¸­ç›´æ¥ç”¨ `<script>` å¼•å…¥ CDN
2. `vue.config.js` ä¸­æ”¹ webpack çš„ `externals` é…ç½®ï¼Œæ ¼å¼ç™¾åº¦
3. å»æ‰ `package.json` ä¸­å¯¹åº”çš„æ¨¡å—ä¾èµ–é¡¹

## å‚è€ƒæ–‡ç« 

[vue-cli cdn æ–¹å¼å¼•å…¥ Vue æ¨¡å—](https://juejin.cn/post/6982490135958913060)

https://webpack.js.org/configuration/externals/

https://www.jianshu.com/p/f17f3c9efda3

å°†åŸæ¥å¼•å…¥çš„æ¨¡å—å…¨éƒ¨æ”¹æˆ CDN å¼•å…¥ï¼Ÿ

https://www.jianshu.com/p/9fcdd556b62e

[Vuetify CDN å¼•å…¥](https://stackoverflow.com/questions/67995021/how-can-i-avoid-bundling-vuetify-and-use-from-cdn)

[å‰ç«¯æ€§èƒ½ç›‘æ§æ–¹æ¡ˆ](https://juejin.cn/post/6844904020482457613)

[ğŸ¢11såˆ°âš¡1sï¼Œæ€§èƒ½ä¼˜åŒ–ä¹‹é¦–å±åŠ è½½ğŸš€](https://juejin.cn/post/6949896020788690958)

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211216130310.png)

[è…¾è®¯å…¨ç«¯ AlloyTeam - å¦‚ä½•è¿›è¡Œ Web æ€§èƒ½ç›‘æ§ï¼Ÿ](http://www.alloyteam.com/2020/01/14184/)

## window.performance

**å¯ä»¥ä½¿ç”¨Navigation.timing ç»Ÿè®¡åˆ°çš„æ—¶é—´æ•°æ®æ¥è®¡ç®—ä¸€äº›é¡µé¢æ€§èƒ½æŒ‡æ ‡ï¼Œæ¯”å¦‚DNSæŸ¥è¯¢è€—æ—¶ã€ç™½å±æ—¶é—´ã€domreadyç­‰ç­‰ã€‚å¦‚ä¸‹ï¼š**

+ **DNSæŸ¥è¯¢è€—æ—¶ = domainLookupEnd - domainLookupStart**
+ **TCPé“¾æ¥è€—æ—¶ = connectEnd - connectStart**
+ **requestè¯·æ±‚è€—æ—¶ = responseEnd - responseStart**
+ **è§£ædomæ ‘è€—æ—¶ = domComplete - domInteractive**
+ **ç™½å±æ—¶é—´ = domloadng - fetchStart**
+ **domreadyæ—¶é—´ = domContentLoadedEventEnd - fetchStart**
+ **onloadæ—¶é—´ = loadEventEnd - fetchStart**

```json
connectEnd: 1639631178000
connectStart: 1639631177992
domComplete: 1639631208914
domContentLoadedEventEnd: 1639631184469
domContentLoadedEventStart: 1639631184469
domInteractive: 1639631184469
domLoading: 1639631178020
domainLookupEnd: 1639631177992
domainLookupStart: 1639631177902
fetchStart: 1639631177897
loadEventEnd: 1639631208914
loadEventStart: 1639631208914
navigationStart: 1639631177893
redirectEnd: 0
redirectStart: 0
requestStart: 1639631178000
responseEnd: 1639631178009
responseStart: 1639631178008
secureConnectionStart: 0
unloadEventEnd: 0
unloadEventStart: 0
```



## æŠ¥é”™è¸©å‘

### Cannot redefine property: $router

åœ¨å°è¯•å¤–éƒ¨å¼•å…¥ vue, vue-router, vuex çš„æ—¶å€™æŠ¥é”™

åŸå› ï¼špackage.json å’Œ cdn é‡å¤å¼•ç”¨

è§£å†³ï¼šåˆ å» package.json ä¸­å¯¹åº”çš„é¡¹ç›®

### tarball ... seems to be corrupted

`npm i webpack-bundle-analyzer` ä¸€ç›´æŠ¥è¿™ä¸ªé”™

åæ¥æ²¡åŠæ³•äº†ï¼Œç›´æ¥ 4 è¿ï¼š

+ `npm cache verify`
+ remove `package-lock.json`
+ remove `node_modules`
+ `npm install`

æå®Œä¸Šè¿°æ­¥éª¤ï¼Œeslint å¥½åƒåˆå‡ºç°äº†é—®é¢˜ï¼Œqnmdï¼Œwc

ä» package.json ä¸­å»æ‰äº†è¿™ä¸ª

```
"@vue/cli-plugin-eslint": "~4.5.0",
```



## æ•°æ®å¤‡ä»½

`package.json`

```json
{
  "name": "hitszoj-web-pre",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "lint": "vue-cli-service lint"
  },
  "dependencies": {
    "@bytemd/plugin-gemoji": "^1.10.13",
    "@bytemd/plugin-gfm": "^1.10.13",
    "@bytemd/plugin-highlight": "^1.10.13",
    "@bytemd/plugin-math": "^1.10.13",
    "@bytemd/plugin-mermaid": "^1.10.13",
    "@bytemd/vue": "^1.10.13",
    "ant-design-vue": "^1.7.8",
    "axios": "^0.21.4",
    "core-js": "^3.6.5",
    "crypto-js": "^4.1.1",
    "github-markdown-css": "^4.0.0",
    "katex": "^0.12.0",
    "marked": "^3.0.4",
    "mavon-editor": "^2.9.1",
    "monaco-editor-webpack-plugin": "^1.9.1",
    "qiniu-js": "^3.3.3",
    "vue": "^2.6.11",
    "vue-cropper": "^0.5.6",
    "vue-monaco": "^1.2.2",
    "vue-router": "^3.2.0",
    "vue-splitpane": "^1.0.6",
    "vuetify": "^2.4.0",
    "vuex": "^3.6.2"
  },
  "devDependencies": {
    "@mdi/font": "^6.1.95",
    "@vue/cli-plugin-babel": "~4.5.0",
    "@vue/cli-plugin-eslint": "~4.5.0",
    "@vue/cli-plugin-router": "~4.5.0",
    "@vue/cli-service": "~4.5.0",
    "babel-eslint": "^10.1.0",
    "eslint": "^6.7.2",
    "eslint-plugin-vue": "^6.2.2",
    "sass": "~1.32.0",
    "sass-loader": "^10.0.0",
    "vue-cli-plugin-vuetify": "~2.4.2",
    "vue-template-compiler": "^2.6.11",
    "vuetify-loader": "^1.7.0"
  }
}

```

