# 项目经验记录

本文记录 HITSZOJ 数据结构课程实验平台的项目经验和反思（前端部分）

## 认证授权模块

### 登录逻辑

前端

+ 基本页面搭建
  + 密码框要有隐藏功能
+ 绑定登录表单和数据对象
+ 写 `login()` 函数
  + 新建一个 `FormData` 对象
  + 将用户名和密码添加到其中
  + 用 axios 发送 post 请求给后端
  + 拿回后端给的 JSON 形式的 Result 对象

后端

+ 数据库建表
+ 写 User 实体类
+ 写 UserMapper 接口和 UserMapper.xml
  + 实现基本查询功能
+ 写 UserService 及其实现类
  + 验证逻辑写在实现类中， 不要写在 Controller
  + 登录基本逻辑
    + 根据用户名查找用户
      + 用户存在
        + 验证密码
        + 返回结果
      + 用户不存在
        + 返回结果
  + 返回信息形式
    + 写一个 Result 实体类，记录
      + code 返回状态码
      + msg 返回信息
      + data 携带数据
    + 返回时返回它的实例对象，转为 JSON 给前端
+ 写 UserController
  + 写好接口 URL
  + 参数用 `@RequestParam` 形式接受
  + 返回的 Result 对象要转成 JSON，方法记得加 `@ResponseBody`

## 经验反思

**1.认证授权模块应该放在最后做**

本项目从一开始做了几个页面之后就马上先做了认证授权模块，该模块对整个前端代码有比较强的侵入性，不方便抽离，与此同时，认证授权需要时刻和后端通信（因为需要通过 JWT 确认身份），这就导致了两个问题：

+ 前端和后端无法完全解耦，一旦后端服务下线或出问题，前端的工作就要被迫暂停
+ 后端在很早就加入了 JWT 认证过滤器，会拦截所有请求并验证身份信息，这就导致后端在新增功能模块需要测试接口时，必须要往过滤器白名单中添加新接口路径，才能测试

**2.复用次数较多的代码块要及时封装抽离解耦**

例如：

+ 一开始频繁使用 axios 直接收发请求，后来封装成 `HttpService` 对象并在其中配置好 `baseURL` 和拦截器，所有涉及服务端接口的请求都使用这个 `HttpService` 来收发（与此同时，`baseURL` 将服务端地址与具体接口路径解耦了）
+ 在项目初期一直使用 `resp.data` 这种方式来从服务端响应中抽取业务数据，后来服务端返回的数据结构经过多次改动，加了包装，意识到需要将“从响应中提取数据”这件事情独立出来，于是有了 `ResponseExtractor`，其中包含 `getData()`，`getMsg()` 等方法

**3.将可复用的模块封装成 Vue 组件**

在项目初期，页面很少，所有页面都是直接用各种标签和样式组装而成的，到后来发现 Markdown 文章渲染区、评论区、文章列表等模块在多处地方都需要使用，于是将其封装成简单组件.

后来，为了将我封装的这些组件给前端组里其他同学使用，又增加了一些 `props` 和 `$emit`，暴露出部分数据接口和方法钩子，这时候，它们才能称为真正意义上的组件.

**4.尽可能少地引入外部库，如有需要尽量局部引入**

一开始总是将所有用到的外部模块全部在 `main.js` 中引入，后来改成在需要用到的最小组件内部引入.
