# Monaco 编辑器自适应问题

> 2021.12.12  2:31  By CJH

今天晚上，就是说我差点破防了，兄弟们，前端视图层，破事是真的多

这个故事叫《山重水复疑无路，菜鸟前端迷了路》，有兴趣的朋友可以听我慢慢说完

故事得从一个页面的布局说起

今天考完马原，晚上比较有空，我寻思上几周那个页面布局还有点小问题，今晚给他整一下

是的，就是下面这个页面（可以理解为是仿照 LeetCode 的布局做的）

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211212014258.png)

从图中可以看出，这个页面的构思不难理解，上面一个固定的 nav，下面是一个占满剩余空间且不允许滚动的做题面板 (`overflow: hidden` 加上手动设置高度 `100vh-导航栏高度` 实现)，切成左右两个 flexbox，比例是黄金分割比，38.2% 比 61.8%

右边又是一个 flex 父容器，子元素是垂直方向的四个 flexbox 依次排列，分别为**编辑器配置区**、**代码编辑区**、**测试区**、**提交执行区**，其中除了代码编辑区外，其他区域高度都固定且不允许弹性伸缩 (`flex: 0 0`)，只有代码编辑区允许 `flex: 1 1 auto`

其实说白了，就是竖直方向的圣杯布局，上下两侧区域定高，中间区域自动填满剩余空间.

刷刷刷敲完了，好像很简单，咋一看，页面在 `resize` 的时候，代码编辑区并不会自适应地调整大小，它只会保持它在页面初始化时的大小！

这肯定是不行的，因为如果代码编辑区不会自适应，意味着右边一整个 flexbox 的高度不会随窗口 `resize` 缩小，加之 `overflow: hidden`，就会导致下面的测试、提交等视图跑出用户视窗范围，无法点击和操作.

我首先将圣杯布局的代码检查了 2 遍，确定没有问题.

这个编辑器使用的是微软开源的 `monaco-editor`，估计问题出在它身上，于是跑去它的 GitHub 查 Issue，搜索跟 `flex`，`layout`有关的 Issue，一条一条看

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211212020557.png)

看了一大堆，发现这个 `monaco` 在它的 options 里面提供了 `automaticLayout` 的选项，只要将其设置为 `true`，就能实现自适应.

我直呼牛逼，那问题不就解决了吗？

加上这个 option 之后发现，宽度确实能够随页面 resize 自适应了，可为什么高度没办法自适应？？

于是继续搜索，查到说：编辑器实例 `editorInstance` 上有一个 `layout()` 方法，可以重置宽高、手动重置布局，我一看，欸，那还不简单，监听一下 `window.onresize`，手动重置布局就可以了嘛！

明明 `editorInstance` 的实例上有 `layout()` 方法（虽然不在它自己身上，而是在在它的原型的原型的原型上），但我在调用的时候死活调不出来这个方法

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211212023510.png)

我不知道为什么一个明明存在对象原型链上的方法，就是没法调出来。。？

我还是不死心

于是我用 `Object.getPrototypeOf()` 拿到了原型链上含有 `layout()` 方法的那个原型对象，再用 `xxx.layout.call(editorInstance)`，仍然没有效果

然后！我翻到的另外一个 Issue 里面说，其实 `automaticLayout` 底层的实现就是每隔 100 ms 就自动跑一次 `layout()`，我很惊讶，因为这实在是太过暴力了，但是，除去惊讶之外，我甚至有些破防，因为这告诉我每隔 100 ms 其实 `layout()` 都会被调一次，那我之间做的尝试都是对的，不是方法没有调出来，只不过是 `layout()` 并没有对布局起作用罢了。。。搞了半天，做的事情都是白费功夫。。。

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211212022400.png)

最后最后，功夫不负有心人，我在一个很不起眼的角落翻到了一个 issue

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211212022652.png)

这个评论者说，其实编辑器高度就是不能够自动适应 flexbox 的调整的，你需要手动给它的父容器设置一个 `overflow: hidden`，所有事情就解决了

确实，我从 12 点忙活到 2 点仍然毫无头绪的事情，被父容器的一句 `overflow: hidden` 给解决了

唉，不知道该说什么好

**山重水复疑无路，柳暗花明又一村，**

**前端菜鸟常迷路，组件布局两眼昏。**

只能说，不要靠近 Web 前端，不要靠近视图层，真的会变得不幸🙏

如果你身边有做前端的朋友，要多关心一下ta，不知道哪天就被布局或者奇葩组件给气死了🙏