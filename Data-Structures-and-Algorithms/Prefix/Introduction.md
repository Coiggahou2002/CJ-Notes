# 基本概念

## 一维前缀和

用数列观点理解就是前 $n$ 项和，原序列是 $a_n$，它的前缀和就是

$$
S_n=\sum_{i=1}^{n} a_i
$$

对于序列 $\{a_n\}$ ，需要查询区间 $[l,r]$ 上所有元素的和，一般做法是 $O(n)$ 的线性扫描.

但如果需要频繁查询，那么一般先对序列 $\{a_n\}$ 做预处理，做出它的前缀和序列 $\{S_n\}$.

当需要区间 $[l,r]$ 上的和时，只需要计算 $S_r-S_{l-1}$ ，可在 $O(1)$ 内完成.

## 二维前缀和

可用矩阵来理解（或者看成网格），$a[i][j]$ 存储一个二维数据图，它的前缀和为

$$
S[i][j]=\sum_{i=1}^{n} \sum_{j=1}^{m}a_[i][j]
$$

简单来说，二维前缀和 $S[i][j]$ 表示矩阵前 $i$ 行、前 $j$ 列的和.

根据原矩阵构造其对应二位前缀和的公式为

![](https://cjpark-1304138896.cos.ap-guangzhou.myqcloud.com/note_img/20211016154304.png)
$$
S[i][j]=S[i-1][j]+S[i][j-1]-S[i-1][j-1]+a[i][j]
$$

构造完二维前缀和后，我们可以方便地求出任意子矩阵的和.

例如求从 $(x_1,y_1)$ 到 $(x_2,y_2)$ 的子矩阵和 $sum$.（类似容斥原理）

$$
sum=S[x_2][y_2]-S[x_1-1][y_2]-S[x_2][y_1-1]+S[x_1-1][y_1-1]
$$

Tips: 当空间非常紧张的时候，可以原地计算前缀和并覆盖原矩阵，即每计算出一个 $S[i][j]$ ，就用它覆盖掉 $a[i][j]$ ，可以省掉另外开一个 $S[][]$ 数组的空间开销.
